<apex:page standardController="Package__c" extensions="Custom_Package_Controller"
           tabStyle="Product2" lightningStylesheets="true" docType="html-5.0">
      
    <apex:pageBlock >
        <h1><center>New Suprise Package</center></h1>
    </apex:pageBlock>
    <apex:form id="form" >
        <apex:pageMessages id="msg"/>
         
        <apex:pageBlock >
           
            <center><apex:panelGrid columns="2" >
                <apex:commandButton value="Save"  action="{!Save}" rerender="form,form2"/>
                <apex:actionRegion >
                <apex:commandButton value="Cancel" action="{!Cancel}" immediate="true" 
                                        html-formnovalidate="formnovalidate" /></apex:actionRegion>
                </apex:panelGrid></center>
            <br/>
            <!--Package Information -->
            <apex:pageBlockSection >
                <apex:inputField value="{!Package__c.Name}" required="true"/>
                <apex:outputText value="{!Package__c.Quantity_of_Goods_Sold__c}"/>
                <apex:inputField value="{!Package__c.Account__c}"/>
                <apex:outputText value="{!Package__c.Cost_of_Goods_Sold__c}"/>
                <apex:inputField value="{!Package__c.Package_Type__c}"/>
                <apex:inputField value="{!Package__c.Shipping_Date__c}"/>
            </apex:pageBlockSection>    
        </apex:pageBlock>
    </apex:form>
 		<apex:form id="form2">
            
         <!--Pie Chart -->	
        <apex:pageBlock title="Package Family Breakdown" id="piechart">
            <apex:pageBlock rendered="{!pieData.size == 0}" >
                <center><apex:outputText value="No items have been added to the Package yet."></apex:outputText></center>
            </apex:pageBlock>
            <apex:outputPanel rendered="{!pieData.size != 0}">
                <center><apex:chart data="{!pieData}" height="450" width="450" background="#ffffff"  >
                    <apex:legend position="right"/>
                    <apex:pieSeries labelField="name" dataField="data"
                                    colorSet="#1E8DAF,#8f71ff,#955196,#dd5182,#fdc57b,#ff6e54"/>
                    </apex:chart></center>
                <apex:actionStatus id="piechartStatus">
                    <apex:facet name="start">
                        Updating Pie Chart...<img src="/img/loading32.gif" style="width: 150px;"/>
                    </apex:facet>
                </apex:actionStatus>
            </apex:outputPanel>
        </apex:pageBlock>
        
        <!--List of Products -->
         <apex:pageBlock title="Products"  id="ProductTable">  
            <!--Filter by product Family-->
            <apex:panelGrid columns="2">
                <apex:outputLabel value="View: "/>
                <apex:inputField value="{!product.Family}">
                    <apex:actionSupport event="onchange" action="{!searchProducts}" status="paginationStatus" reRender="ProductTable,piechart"  />
    			</apex:inputField>   
                <apex:pageMessages/>
                
            </apex:panelGrid>
            
            <apex:pageBlock rendered="{!wrapperRecordList.size == 0}" >
                <center><apex:outputText ><h3>No Products found.</h3></apex:outputText></center>
            </apex:pageBlock>
            
            <apex:pageBlockTable id="wl" value="{!wrapperRecordList}" rendered="{!wrapperRecordList.size!=0}" var="list">
                <apex:column headerValue="Quantity" >
                    <apex:input value="{!list.qty}" required="true" />   
                </apex:column>
                <apex:column headerValue="Product Name">
                    <apex:outputLink target="_blank" value="/{!list.product.id}">{!list.product.Name}</apex:outputLink>  </apex:column>
                <apex:column headerValue="Product Family">
                    <apex:outputText value="{!list.product.Family}"/>
                </apex:column>
                <apex:column headerValue="Cost">
                    <apex:outputField value="{!list.product.Cost__c}"/>
                </apex:column>      
            </apex:pageBlockTable>
            <!-- Action Buttons visible on bottom of page for pagination -->
            <apex:outputPanel style="text-align:center;" layout="block">  
                <apex:commandButton value="First"  reRender="ProductTable,piechart" action="{!first}" disabled="{!NOT(hasPrevious)}" status="paginationStatus"/>
                <apex:commandButton value="Previous"   rerender="ProductTable,piechart" action="{!previous}" disabled="{!NOT(hasPrevious)}" status="paginationStatus"/>&nbsp;Page {!pageNumber} of {!totalPages}&nbsp;
                <apex:commandButton value="Next"   rerender="ProductTable,piechart" action="{!next}" disabled="{!NOT(hasNext)}" status="paginationStatus"/>
                 <apex:commandButton value="Last"   rerender="ProductTable,piechart" action="{!last}" disabled="{!NOT(hasNext)}" status="paginationStatus"/>
                <apex:actionStatus id="paginationStatus">
                    <apex:facet name="start">
                        Please wait...<img src="/img/loading32.gif" style="width: 18px;"/>
                    </apex:facet>
                </apex:actionStatus>
            </apex:outputPanel> 
                 
        </apex:pageBlock> 
       
    </apex:form>
    
    
</apex:page>
